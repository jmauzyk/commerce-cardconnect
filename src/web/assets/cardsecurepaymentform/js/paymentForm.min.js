function initTokenizer(w){const y="^4[0-9]{3}([\\\\ \\-]?)(?:[0-9]{4}\\1){2}[0-9](?:[0-9]{3})?|5[1-5][0-9]{2}([\\\\ \\-]?)[0-9]{4}\\2[0-9]{4}\\2[0-9]{4}|6(?:011|22(?:1(?=[\\\\ \\-]?(?:2[6-9]|[3-9]))|[2-8]|9(?=[\\\\ \\-]?(?:[01]|2[0-5])))|4[4-9][0-9]|5[0-9][0-9])([\\\\ \\-]?)[0-9]{4}\\3[0-9]{4}\\3[0-9]{4}|3[47][0-9][0-9]([\\\\ \\-]?)[0-9]{6}\\4[0-9]{5}$";const v="^[0-9]{2}\\*{9,10}[0-9]{4}$";const o="^(0[1-9]|1[0-2])/[0-9]{4}$";const e="^[0-9]{3}$";const g="^[0-9]{4}$";const q=document.getElementById("cc-cardNumber");const i=document.getElementById("cc-expiry");const x=document.getElementById("cc-month");const n=document.getElementById("cc-year");const m=document.getElementById("cc-cvv");var d=[q,m];var p=new JSEncrypt();var z={account:"",encryptionhandler:"RSA",expiry:"",cvv:""};var l=null;if(!q.getAttribute("pattern")){q.setAttribute("pattern",y)}if(i!==null&&!i.getAttribute("pattern")){i.setAttribute("pattern",o)}if(m.getAttribute("pattern")){m.setAttribute("pattern",e)}const f="https://"+w+".cardconnect.com/cardsecure/api/v1/ccn/tokenize";q.addEventListener("keydown",function(A){var B=new RegExp(v);if(!(A instanceof KeyboardEvent)&&B.test(this.value)){j()}if(A.keyCode===8||A.keyCode===46){A.preventDefault();if(this.classList.contains("obfuscated")){j()}else{s("",this.selectionStart===this.selectionEnd)}}});q.addEventListener("keypress",function(D){var C=D.charCode||D.keyCode||D.which;if(C!==9&&(C<37||C>40)&&!(D.ctrlKey&&(C===99||C===118))){D.preventDefault();var B=String.fromCharCode(C);var A=/^\D*3[47]/.test(this.value);a(A);if(/\D/.test(B)||(this.selectionStart===this.selectionEnd&&this.value.replace(/\D/g,"").length>=(A?15:16))){return false}if(this.classList.contains("obfuscated")){if(this.selectionStart!==this.selectionEnd){j()}else{return false}}s(B)}});q.addEventListener("keyup",function(B){if(!(B instanceof KeyboardEvent)){s("")}clearTimeout(l);if(b()){var A=0;if(/^4[0-9]{11,15}$/.test(this.value.replace(/\D/g,""))){A=750}l=setTimeout(function(){if(u()){c(f,z)}},A)}});q.addEventListener("paste",function(A){this.classList.remove("obfuscated");this.setAttribute("pattern",y);setTimeout(function(){s("");if(b()){if(u()){c(f,z)}}},50)});q.addEventListener("focusout",function(B){var A=/^\D*3[47]/.test(this.value);a(A);if(B instanceof KeyboardEvent){clearTimeout(l);if(b()){if(u()){c(f,z)}}}});if(i!==null){i.addEventListener("keyup",function(B){if(t(this)){var A=this.value.replace(/\s/g,"").split("/");z.expiry=A[1]+A[0]}else{z.expiry=""}if(b()){if(u()){c(f,z)}}});d.push(i)}else{var r,h;if(x.tagName==="INPUT"&&(x.type=="text"||x.type=="number"||x.type=="tel")){r="keyup"}else{r="change"}if(n.tagName==="INPUT"&&(n.type=="text"||n.type=="number"||n.type=="tel")){h="keyup"}else{h="change"}x.addEventListener(r,function(A){if(t(x)&&t(n)){z.expiry=n.value+x.value}else{z.expiry=""}if(b()){if(u()){c(f,z)}}});n.addEventListener(h,function(A){if(t(n)&&t(x)){z.expiry=n.value+x.value}else{z.expiry=""}if(b()){if(u()){c(f,z)}}});d.push(x,n)}m.addEventListener("keyup",function(A){if(t(this)){z.cvv=this.value}else{z.cvv=""}if(b()){if(u()){c(f,z)}}});function t(A){return A.value.length&&A.checkValidity()}function u(){if(t(q)&&!q.classList.contains("obfuscated")){const B="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnzsO9YnmdZUkJzM9S/UemBF5bgv2MHHxGjoeD3mM3e4yOVilG61obBN8jlFu3Jv3ba1NGR6sfqIWoCNVpnu0YJtvPdNwRL+oLX8WS+DsXmhuxqouTduk/Z21E/CEkmhnazjcxB3svtd2v5S+NMc+VAmr+KYN9/6g6E34aMAJLkvg86mumWpsncKHdRbX/ZD6dYpV17bK9yeFBL+v6ewm4OAe/q1dwQ/+uZSZdNOzVg66GShxgTgZcyDk9HJKC7LqEarxvsfSSBZb1XkWpLeKzXKQrqaqD40bPRB8UbVNROeOtqir2dmU6bNRyC7oA+U69nppcwCtPOzzJ0pIj65d0QIDAQAB";p.setPublicKey(B);var C=q.value.replace(/\s/g,"");var D=p.encrypt(C);z.account=D;var A=C.substring(0,2)+Array(C.length-5).join("*")+C.substring(C.length-4);C=null;q.value=A;q.classList.add("obfuscated");q.setAttribute("pattern",v);return true}return false}function j(){p=new JSEncrypt();z.account="";document.getElementById("cc-number").value="";q.value="";q.classList.remove("obfuscated");q.setAttribute("pattern",y);m.setAttribute("pattern",e);m.setAttribute("maxlength",3)}function b(){var A=[];d.forEach(function(B){A.push(t(B))});return A.every(k)}function k(A){return A}function c(B,A){var C=new XMLHttpRequest();C.open("POST",B,true);C.setRequestHeader("Content-Type","application/json");C.onload=function(){if(C.status!==200){console.log(C.responseText);alert("An error occurred! Please reload and try again or contact the webmaster.");location.reload()}else{var D=JSON.parse(C.responseText);document.getElementById("cc-number").value=D.token}};C.onerror=function(){console.log(C.responseText);alert("An error occurred! Please reload and try again or contact the webmaster.");location.reload()};C.send(JSON.stringify(A))}function s(E,H){var B=0;var D=0;var K=0;var G=" ";var L=q.value;if(E!==false){B=q.selectionStart;D=q.selectionEnd;if(H&&B>0){B--;if(L[B]==G){B--}}L=L.substring(0,B)+E+L.substring(D);K=B+E.length}var J=0;var M=0;var I=0;var A="";var C=/^\D*3[47]/.test(L)?[4,6,5]:[4,4,4,4];for(var F=0;F<L.length;F++){if(/\D/.test(L[F])){if(B>F){K--}}else{if(J===C[I]){A+=G;J=0;I++;if(B>=F){K++}}A+=L[F];J++;M++}if(J===C[I]&&C.length===I+1){break}}q.value=A;if(E!==false){q.setSelectionRange(K,K)}}function a(A){if(A){if(m.pattern!==g){m.setAttribute("pattern",g);m.setAttribute("maxlength",4)}}else{if(m.pattern!==e){m.setAttribute("pattern",e);m.setAttribute("maxlength",3)}}}};
