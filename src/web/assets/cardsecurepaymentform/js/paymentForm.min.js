function initTokenizer(v){const x="^4[0-9]{3}([\\\\ \\-]?)(?:[0-9]{4}\\1){2}[0-9](?:[0-9]{3})?|5[1-5][0-9]{2}([\\\\ \\-]?)[0-9]{4}\\2[0-9]{4}\\2[0-9]{4}|6(?:011|22(?:1(?=[\\\\ \\-]?(?:2[6-9]|[3-9]))|[2-8]|9(?=[\\\\ \\-]?(?:[01]|2[0-5])))|4[4-9][0-9]|5[0-9][0-9])([\\\\ \\-]?)[0-9]{4}\\3[0-9]{4}\\3[0-9]{4}|3[47][0-9][0-9]([\\\\ \\-]?)[0-9]{6}\\4[0-9]{5}$";const u="^[0-9]{2}\\*{9,10}[0-9]{4}$";const n="^(0[1-9]|1[1-2])/[0-9]{4}$";const d="^[0-9]{3}$";const f="^[0-9]{4}$";const p=document.getElementById("cc-cardNumber");const h=document.getElementById("cc-expiry");const w=document.getElementById("cc-month");const m=document.getElementById("cc-year");const l=document.getElementById("cc-cvv");var c=[p,l];var o=new JSEncrypt();var y={account:"",encryptionhandler:"RSA",expiry:"",cvv:""};var k=null;if(!p.getAttribute("pattern")){p.setAttribute("pattern",x)}if(h!==null&&!h.getAttribute("pattern")){h.setAttribute("pattern",n)}if(l.getAttribute("pattern")){l.setAttribute("pattern",d)}const e="https://"+v+".cardconnect.com/cardsecure/api/v1/ccn/tokenize";p.addEventListener("keydown",function(z){var A=new RegExp(u);if(!(z instanceof KeyboardEvent)&&A.test(this.value)){i()}if(z.keyCode===8||z.keyCode===46){z.preventDefault();if(this.classList.contains("obfuscated")){i()}else{r("",this.selectionStart===this.selectionEnd)}}});p.addEventListener("keypress",function(C){var B=C.charCode||C.keyCode||C.which;if(B!==9&&(B<37||B>40)&&!(C.ctrlKey&&(B===99||B===118))){C.preventDefault();var A=String.fromCharCode(B);var z=/^\D*3[47]/.test(this.value);if(z){if(l.pattern!==f){l.setAttribute("pattern",f);l.setAttribute("maxlength",4)}}else{if(l.pattern!==d){l.setAttribute("pattern",d);l.setAttribute("maxlength",3)}}if(/\D/.test(A)||(this.selectionStart===this.selectionEnd&&this.value.replace(/\D/g,"").length>=(z?15:16))){return false}if(this.classList.contains("obfuscated")){if(this.selectionStart!==this.selectionEnd){i()}else{return false}}r(A)}});p.addEventListener("keyup",function(A){if(!(A instanceof KeyboardEvent)){r("")}clearTimeout(k);if(a()){var z=0;if(/^4[0-9]{11,15}$/.test(this.value.replace(/\D/g,""))){z=750}k=setTimeout(function(){if(t()){b(e,y)}},z)}});p.addEventListener("paste",function(z){this.classList.remove("obfuscated");this.setAttribute("pattern",x);setTimeout(function(){r("");if(a()){if(t()){b(e,y)}}},50)});p.addEventListener("focusout",function(z){if(z instanceof KeyboardEvent){clearTimeout(k);if(a()){if(t()){b(e,y)}}}});if(h!==null){h.addEventListener("keyup",function(A){if(s(this)){var z=this.value.replace(/\s/g,"").split("/");y.expiry=z[1]+z[0]}else{y.expiry=""}if(a()){if(t()){b(e,y)}}});c.push(h)}else{var q,g;if(w.tagName==="INPUT"&&(w.type=="text"||w.type=="number"||w.type=="tel")){q="keyup"}else{q="change"}if(m.tagName==="INPUT"&&(m.type=="text"||m.type=="number"||m.type=="tel")){g="keyup"}else{g="change"}w.addEventListener(q,function(z){if(s(w)&&s(m)){y.expiry=m.value+w.value}else{y.expiry=""}if(a()){if(t()){b(e,y)}}});m.addEventListener(g,function(z){if(s(m)&&s(w)){y.expiry=m.value+w.value}else{y.expiry=""}if(a()){if(t()){b(e,y)}}});c.push(w,m)}l.addEventListener("keyup",function(z){if(s(this)){y.cvv=this.value}else{y.cvv=""}if(a()){if(t()){b(e,y)}}});function s(z){return z.value.length&&z.checkValidity()}function t(){if(s(p)&&!p.classList.contains("obfuscated")){const A="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnzsO9YnmdZUkJzM9S/UemBF5bgv2MHHxGjoeD3mM3e4yOVilG61obBN8jlFu3Jv3ba1NGR6sfqIWoCNVpnu0YJtvPdNwRL+oLX8WS+DsXmhuxqouTduk/Z21E/CEkmhnazjcxB3svtd2v5S+NMc+VAmr+KYN9/6g6E34aMAJLkvg86mumWpsncKHdRbX/ZD6dYpV17bK9yeFBL+v6ewm4OAe/q1dwQ/+uZSZdNOzVg66GShxgTgZcyDk9HJKC7LqEarxvsfSSBZb1XkWpLeKzXKQrqaqD40bPRB8UbVNROeOtqir2dmU6bNRyC7oA+U69nppcwCtPOzzJ0pIj65d0QIDAQAB";o.setPublicKey(A);var B=p.value.replace(/\s/g,"");var C=o.encrypt(B);y.account=C;var z=B.substring(0,2)+Array(B.length-5).join("*")+B.substring(B.length-4);B=null;p.value=z;p.classList.add("obfuscated");p.setAttribute("pattern",u);return true}return false}function i(){o=new JSEncrypt();y.account="";document.getElementById("cc-number").value="";p.value="";p.classList.remove("obfuscated");p.setAttribute("pattern",x);l.setAttribute("pattern",d);l.setAttribute("maxlength",3)}function a(){var z=[];c.forEach(function(A){z.push(s(A))});return z.every(j)}function j(z){return z}function b(A,z){var B=new XMLHttpRequest();B.open("POST",A,true);B.setRequestHeader("Content-Type","application/json");B.onload=function(){if(B.status!==200){console.log(B.responseText);alert("An error occurred! Please reload and try again or contact the webmaster.");location.reload()}else{var C=JSON.parse(B.responseText);document.getElementById("cc-number").value=C.token}};B.onerror=function(){console.log(B.responseText);alert("An error occurred! Please reload and try again or contact the webmaster.");location.reload()};B.send(JSON.stringify(z))}function r(D,G){var A=0;var C=0;var J=0;var F=" ";var K=p.value;if(D!==false){A=p.selectionStart;C=p.selectionEnd;if(G&&A>0){A--;if(K[A]==F){A--}}K=K.substring(0,A)+D+K.substring(C);J=A+D.length}var I=0;var L=0;var H=0;var z="";var B=/^\D*3[47]/.test(K)?[4,6,5]:[4,4,4,4];for(var E=0;E<K.length;E++){if(/\D/.test(K[E])){if(A>E){J--}}else{if(I===B[H]){z+=F;I=0;H++;if(A>=E){J++}}z+=K[E];I++;L++}if(I===B[H]&&B.length===H+1){break}}p.value=z;if(D!==false){p.setSelectionRange(J,J)}}};
